<%= link_to '戻る', (request.referer.presence || root_path), class: 'back-link' %>

<div class="room-details">
  <%= image_tag(@room.image.attached? ? @room.image : 'room.png', class: 'room-image') %>

  <h1><%= @room.name %></h1>

  <!-- 住所 -->
  <p class="room-address"><%= @room.address %></p>

  <!-- 料金 (/日) -->
  <p class="room-price">
    <%= number_to_currency(@room.price, unit: '¥', precision: 0) %> / 日
  </p>

  <!-- 紹介文 -->
  <div class="room-description">
    <%= simple_format(@room.description) %>
  </div>
</div>

<div class="booking-section">
  <% if user_signed_in? %>
    <%# フォーム %>
    <%= form_with model: @reservation,
                  url: confirm_room_reservations_path(@room),
                  method: :post,
                  local: true do |f| %>

      <%= f.hidden_field :room_id, value: @room.id %>

      <p>
        チェックイン：
        <%= f.date_field :check_in,
                         min:  Date.today,
                         value: (@reservation.check_in || params[:check_in]) %>
      </p>

      <p>
        チェックアウト：
        <% min_checkout =
             begin
               ( (@reservation.check_in || params[:check_in]).to_date + 1 )
             rescue
               Date.today + 1
             end %>
        <%= f.date_field :check_out,
                         min:  min_checkout,
                         value: (@reservation.check_out || params[:check_out]) %>
      </p>

      <p>
        人数：
        <%= f.number_field :guests,
                           min: 1,
                           value: (@reservation.guests.presence || params[:guests] || 1) %>
      </p>

      <%= f.submit '予約確認', class: 'btn btn-primary' %>
    <% end %>
  <% else %>
    <%= link_to 'ログイン', new_user_session_path, class: 'login-button' %>
  <% end %>
</div>
